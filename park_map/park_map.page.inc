<?php


/**
 * @file
 */

/**
 *
 */
function print_park_map() {

  //$values = new stdClass;
  $values = new stdClass;
  
  // get the image path
  $image_absolute_path = _park_map_load_image_map_url();
  
  if($image_absolute_path){
    $values->image_absolute_path =  $image_absolute_path;
  }
  
  // get the geolocation values:
  $park_map_load_map_geolocation = _park_map_load_map_geolocation();

  if($park_map_load_map_geolocation){
    $values->geolocation  =  $park_map_load_map_geolocation;
  }

  // get the firs load.
  $park_map_first_load_data = _park_map_first_load_data();
  
  if($park_map_first_load_data){
    $values->first_load = $park_map_first_load_data;
  }

  // get all the cotent types and all the fields from every content type.
  $park_map_load_content_options = _park_map_load_content_options();

  if($park_map_load_content_options){
    $values->contents =  $park_map_load_content_options;
  }

  drupal_add_js( array('park_map' => $values), 'setting');

  return theme('render_park_map', array ($values));
}


/**
 *
 */
function query_park_map() {

$arguments = preg_split('/&/',  $_SERVER ['QUERY_STRING']);

foreach ($arguments as $argument) {
  $element = preg_split('/=/', $argument);
  $value[$element[0]] = $element[1];
 
}

print_r($value);

  try{

  if(!is_array($value)) {

    throw new Exception("Error Processing Request", 1);
    
  }else {
    // comprobamos que esta la variable de idioma y de tipos de contenido.sino esta no hacemos nada.
    if(!$value['lang']  || !$values['contenttype']) {

      $response = array(
        'status' => 400,
        'data' => 'Bad Request',
      );
      
      return $response;

    } else {
      // montamos la query.
      $query = db_select('node', 'n');
      $query->condition('status', 1, '=');
      $query->condition('n.language', $value['lang'], '=');

      $db_or = db_or(); 
      foreach ($contenttypes as $contenttype) {
        $db_or->condition('n.type', $value, '=');
      }
      $query->condition($db_or);


    }
    
  }
  


  } catch( Exception $e) {

    drupal_set_message(t('No se han recibido los valores bien en la peticiÃ³n'), 'error');

  }
//print drupal_json_output (

$data =  array (   'test'=>true,   'dummy'=>array(0,1),  'url' => $_SERVER['REQUEST_URI']);

  $response = array(
    'status' => 1,
    'data' => $data,
  );
 
  return drupal_json_output($response);
}

/**
 *
 */
function query_park_map_delivery_callback($page_callback_result) {
  print $page_callback_result;
  ajax_footer();
}

////// Funtions to improve the query.

/**
 *
 */